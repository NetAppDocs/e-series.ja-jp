---
permalink: maintenance-e4000/replace-battery-e4000.html 
sidebar: sidebar 
keywords:  
summary:  
---
= E4000のバッテリの交換
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SANtricity System ManagerのRecovery Guruに「バッテリで障害が発生しました」または「バッテリの交換が必要です」というステータスが表示された場合は、E4000アプライアンスのバッテリを交換する必要があります。データを保護するには、できるだけ早くバッテリを交換する必要があります。

SANtricity System Manager の Recovery Guru で詳細を確認し、問題にバッテリが搭載されていること、および先に対処する必要がある項目がほかにないことを確認します。

.作業を開始する前に
障害が発生したバッテリを交換する場合は、次の準備をしておく必要があります。

* 交換用バッテリ。
* ESD リストバンドを装着するか、静電気防止処置を施しておきます。
* コントローラキャニスターに接続する各ケーブルを識別するためのラベル。
* コントローラの SANtricity System Manager にアクセスできるブラウザを備えた管理ステーション。（System Managerインターフェイスを開くには、コントローラのドメイン名またはIPアドレスをブラウザで指定します）。
* 使用中のボリュームがないこと、またはボリュームを使用しているすべてのホストにマルチパスドライバがインストールされていることを確認します。




== 手順1：バッテリを交換する準備をする

バッテリ交換準備の手順は、デュプレックス構成（コントローラが 2 台）とシンプレックス構成（コントローラが 1 台）で異なります。

デュプレックス構成の場合、障害が発生したバッテリを安全に取り外せるように、該当するコントローラをオフラインにする必要があります。オフラインに切り替えないコントローラはオンライン（最適状態）である必要があります。

シンプレックス構成の場合、障害が発生したバッテリを安全に取り外せるように、コントローラシェルフの電源をオフにする必要があります。

[role="tabbed-block"]
====
.コントローラシェルフの電源をオフにする（シンプレックス）
--
.手順
. SANtricity System Managerを使用してストレージアレイの構成データベースをバックアップします。
+
コントローラを取り外すときに問題が発生した場合は、保存したファイルを使用して構成をリストアできます。RAID 構成データベースの現在の状態が保存されます。これには、コントローラ上のボリュームグループとディスクプールのすべてのデータが含まれます。

+
** System Manager から：
+
... *サポート›サポートセンター›診断*を選択します。
... [ 構成データの収集 *] を選択します。
... [*Collect*]( 収集 ) をクリックします
+
ブラウザの Downloads フォルダに、「 * configurationdata-<ArrayName>-<dateTime >.7z * 」という名前でファイルが保存されます。



** または、次の CLI コマンドを使用して構成データベースをバックアップすることもできます。
+
'ave storageArray dbmDatabase sourceLocation=onboard contentType=all file="filename";`



. SANtricity システムマネージャを使用してストレージアレイのサポートデータを収集します。
+
コントローラの取り外し時に問題が発生した場合は、保存したファイルを使用して問題のトラブルシューティングを行うことができます。ストレージアレイに関するインベントリ、ステータス、およびパフォーマンスデータが 1 つのファイルに保存されます。

+
.. *サポート›サポートセンター›診断*を選択します。
.. 「サポートデータの収集」を選択します。
.. [*Collect*]( 収集 ) をクリックします
+
ブラウザの Downloads フォルダに、「 * support-data.7z * 」という名前でファイルが保存されます。



. ストレージアレイと接続されているすべてのホストの間で I/O 処理が発生しないようにします。たとえば、次の手順を実行します。
+
.. ストレージからホストにマッピングされた LUN に関連するすべてのプロセスを停止します。
.. ストレージからホストにマッピングされた LUN にアプリケーションがデータを書き込んでいないことを確認します。
.. アレイのボリュームに関連付けられているファイルシステムをすべてアンマウントします。
+

NOTE: ホスト I/O 処理を停止する具体的な手順はホストオペレーティングシステムや構成によって異なり、ここでは説明していません。環境内でホスト I/O 処理を停止する方法がわからない場合は、ホストをシャットダウンすることを検討してください。

+

CAUTION: *データ損失の可能性*-- I/O処理の実行中にこの手順を続行すると、データが失われる可能性があります。



. キャッシュメモリ内のデータがドライブに書き込まれるまで待ちます。
+
キャッシュされたデータをドライブに書き込む必要がある場合は、コントローラの背面にある緑のキャッシュアクティブ LED が点灯します。この LED が消灯するまで待つ必要があります。

. SANtricity システムマネージャのホームページで、「 * 進行中の処理を表示」を選択します。
. すべての処理が完了したことを確認してから、次の手順に進みます。
. コントローラシェルフの両方の電源スイッチをオフにします。
. コントローラシェルフのすべての LED が消灯するまで待ちます。


--
.コントローラをオフラインにする（デュプレックス）
--
.手順
. SANtricity System Manager の Recovery Guru で詳細を確認し、問題にバッテリが搭載されていること、および先に対処する必要がある項目がほかにないことを確認します。
. Recovery Guru の詳細領域で、交換するバッテリを特定します。
. SANtricity System Managerを使用してストレージアレイの構成データベースをバックアップします。
+
コントローラを取り外すときに問題が発生した場合は、保存したファイルを使用して構成をリストアできます。RAID 構成データベースの現在の状態が保存されます。これには、コントローラ上のボリュームグループとディスクプールのすべてのデータが含まれます。

+
** System Manager から：
+
... *サポート›サポートセンター›診断*を選択します。
... [ 構成データの収集 *] を選択します。
... [*Collect*]( 収集 ) をクリックします
+
ブラウザの Downloads フォルダに、「 * configurationdata-<ArrayName>-<dateTime >.7z * 」という名前でファイルが保存されます。



** または、次の CLI コマンドを使用して構成データベースをバックアップすることもできます。
+
'ave storageArray dbmDatabase sourceLocation=onboard contentType=all file="filename";`



. SANtricity システムマネージャを使用してストレージアレイのサポートデータを収集します。
. コントローラの取り外し時に問題が発生した場合は、保存したファイルを使用して問題のトラブルシューティングを行うことができます。ストレージアレイに関するインベントリ、ステータス、およびパフォーマンスデータが 1 つのファイルに保存されます。
+
.. *サポート›サポートセンター›診断*を選択します。
.. 「サポートデータの収集」を選択します。
.. [*Collect*]( 収集 ) をクリックします
+
ブラウザのDownloadsフォルダにsupport-data.7zという名前でファイルが保存されます。



. コントローラがオフラインでない場合は、 SANtricity System Manager を使用してオフラインにします。
+
** SANtricity システムマネージャで次の作業を行います。
+
... 「 * ハードウェア * 」を選択します。
... 図にドライブが表示された場合は、*[コントローラとコンポーネント]*を選択してコントローラを表示します。
... オフラインに切り替えるコントローラを選択します。
... コンテキストメニューから * オフラインに切り替え * を選択し、操作を確定します。
+

NOTE: オフラインにするコントローラを使用して SANtricity System Manager にアクセスしている場合は、「 SANtricity System Manager を利用できません」というメッセージが表示されます。別のコントローラを使用して SANtricity System Manager に自動的にアクセスするには、 * 代替ネットワーク接続に接続する * を選択します。



** または、次の CLI コマンドを使用してコントローラをオフラインにすることもできます。
+
*コントローラAの場合*： `set controller [a] availability=offline`

+
*コントローラBの場合*： `set controller [b] availability=offline`



. SANtricity System Managerでコントローラのステータスがオフラインに更新されるまで待ちます。
. Recovery Guruで*[再確認]*を選択し、*[詳細]*領域の*[削除する]*フィールドに*[はい]*が表示されていることを確認します。これは、コントローラキャニスターを安全に取り外せることを示しています。


--
====


== 手順2：E4000コントローラキャニスターを取り外す

バッテリを取り外すためには、コントローラキャニスターをコントローラシェルフから取り外す必要があります。

.作業を開始する前に
次のものがあることを確認します。

* ESD リストバンドを装着するか、静電気防止処置を施しておきます。
* コントローラキャニスターに接続する各ケーブルを識別するためのラベル。


.手順
. コントローラキャニスターからすべてのケーブルを外します。
+

CAUTION: パフォーマンスの低下を防ぐために、ケーブルをねじったり、折り曲げたり、はさんだり、踏みつけたりしないでください。

. コントローラキャニスターのホストポートで SFP+ トランシーバを使用している場合は、取り付けたままにしておきます。
. コントローラの背面にあるキャッシュアクティブ LED が消灯していることを確認します。
. カムハンドルのラッチを外れるまで押し、カムハンドルをいっぱいまで開いてコントローラキャニスターをミッドプレーンから外し、両手でコントローラキャニスターをシャーシから半分引き出します。




== 手順3：新しいバッテリを取り付ける

障害が発生したバッテリを取り外して交換する必要があります。

.手順
. 新しいバッテリを開封し、静電気防止処置を施した平らな場所に置きます。
+

NOTE: IATA 安全規則に準拠するため、交換用バッテリは 30% 以下の充電状態（ SoC ）で出荷されます。交換用バッテリに電源を再投入したあと、フル充電されて最初の学習サイクルが完了するまでは、書き込みキャッシュが再開されないことに注意してください。

. まだ接地していない場合は、自分で適切に接地してください。
. コントローラキャニスターをシャーシから取り外します。
. コントローラキャニスターを裏返し、平らで安定した場所に置きます。
. コントローラキャニスターの側面にある青いボタンを押してカバーを開き、カバーを上に回転させてコントローラキャニスターから取り外します。
+
image::../media/drw_E4000_open_controller_module_cover_IEOPS-870.png[コントローラモジュールのカバーを開きます。]

. コントローラキャニスターでバッテリの場所を確認します。
. 障害が発生したバッテリをコントローラキャニスターから取り外します。
+
.. コントローラキャニスターの側面にあるバッテリリリースタブを押します。
.. 保持ブラケットからバッテリを上にスライドさせ、持ち上げてコントローラキャニスターから取り出します。
.. コントローラキャニスターからバッテリを抜きます。
+
image::../media/drw_E4000_replace_nvbattery_IEOPS-862.png[バッテリを取り外します。]

+
|===


 a| 
image::../media/legend_icon_01.png[1つのアイコン]
| バッテリリリースタブ 


 a| 
image::../media/legend_icon_02.png[2つのアイコン]
| バッテリ電源コネクタ 
|===


. 交換用バッテリをパッケージから取り出します。交換用バッテリを取り付けます。
+
.. バッテリコネクタをコントローラキャニスターのソケットに再度接続します。
+
コネクタがマザーボードのバッテリソケットに固定されていることを確認します。

.. バッテリを金属板の側壁の保持ブラケットに合わせます。
.. バッテリリリースタブを下にスライドさせ、バッテリラッチがカチッという音を立てて側壁の開口部にはめ込みます。


. コントローラキャニスターのカバーを再度取り付け、所定の位置にロックします。




== 手順 4 ：コントローラキャニスターを再度取り付けます

コントローラキャニスターのコンポーネントを交換したら、シャーシに再度取り付けます。

.手順
. まだ接地していない場合は、自分で適切に接地してください。
. コントローラキャニスターのカバーを取り付けます（まだ取り付けていない場合）。
. コントローラキャニスターを裏返し、端をシャーシの開口部に合わせます。
. コントローラキャニスターの端をシャーシの開口部に合わせ、コントローラキャニスターをシステムの半分までそっと押し込みます。
+

NOTE: 指示があるまでコントローラキャニスターをシャーシに完全に挿入しないでください。

. 必要に応じてシステムにケーブルを再接続します。
. 光ファイバケーブルを使用する場合は、メディアコンバータ（QSFPまたはSFP）を取り外したあとに再度取り付けてください。
. コントローラキャニスターの再取り付けが完了します。
+
.. カムハンドルを開いた状態で、コントローラキャニスターをミッドプレーンまでしっかりと押し込んで完全に装着し、カムハンドルをロック位置まで閉じます。
+

NOTE: コネクタの破損を防ぐため、コントローラキャニスターをスライドしてシャーシに挿入する際に力を入れすぎないように注意してください。

+
コントローラは、シャーシに装着されるとすぐにブートを開始します。

.. ケーブルマネジメントデバイスを再度取り付けます（まだ取り付けていない場合）。
.. フックとループストラップを使用して、ケーブルをケーブルマネジメントデバイスにバインドします。






== 手順5：バッテリ交換後の処理

バッテリ交換後の手順は、デュプレックス構成（コントローラが2台）とシンプレックス構成（コントローラが1台）で異なります。

[role="tabbed-block"]
====
.コントローラの電源をオンにする（シンプレックス）
--
.手順
. コントローラシェルフの背面にある 2 つの電源スイッチをオンにします。
+
** 電源投入プロセスの実行中は電源スイッチをオフにしないでください。通常、このプロセスは 90 秒以内に完了します。
** 各シェルフのファンは起動時に大きな音を立てます。起動時に大きな音がしても問題はありません。


. コントローラがオンラインに戻ったら、コントローラシェルフの警告LEDを確認します。
+
ステータスが「最適」でない場合やいずれかの警告 LED が点灯している場合は、すべてのケーブルが正しく装着され、バッテリとコントローラキャニスターが正しく取り付けられていることを確認します。必要に応じて、コントローラキャニスターとバッテリを取り外して再度取り付けます。

+

NOTE: 問題を解決できない場合は、テクニカルサポートにお問い合わせください。必要に応じて、 SANtricity System Manager を使用してストレージアレイのサポートデータを収集します。

. SANtricity システムマネージャを使用してストレージアレイのサポートデータを収集します。
+
.. *サポート›サポートセンター›診断*を選択します。
.. [サポートデータの収集]を選択します。
.. 収集をクリックします。
+
ブラウザの Downloads フォルダに、「 * support-data.7z * 」という名前でファイルが保存されます。





--
.コントローラをオンラインにする（デュプレックス）
--
.手順
. SANtricity System Manager を使用して、コントローラをオンラインにします。
+
** SANtricity システムマネージャで次の作業を行います。
+
... 「 * ハードウェア * 」を選択します。
... 図にドライブが表示された場合は、*[コントローラとコンポーネント]*を選択します。
... オンラインに切り替えるコントローラを選択します。
... コンテキストメニューから * オンラインに配置 * を選択し、操作を確定します。
+
コントローラがオンラインになります。



** または、次の CLI コマンドを使用して、コントローラをオンラインに戻すこともできます。
+
*コントローラA *： `set controller [a] availability=online`；

+
*コントローラBの場合*： `set controller [b] availability=online`；



. コントローラがオンラインに戻ったら、コントローラシェルフの警告LEDを確認します。
+
ステータスが「最適」でない場合やいずれかの警告 LED が点灯している場合は、すべてのケーブルが正しく装着され、バッテリとコントローラキャニスターが正しく取り付けられていることを確認します。必要に応じて、コントローラキャニスターとバッテリを取り外して再度取り付けます。

+

NOTE: 問題を解決できない場合は、テクニカルサポートにお問い合わせください。必要に応じて、 SANtricity System Manager を使用してストレージアレイのサポートデータを収集します。

. すべてのボリュームが優先所有者に戻っていることを確認します。
+
.. [ストレージ]>[ボリューム]*を選択します。[ * すべてのボリューム * ] ページで、ボリュームが優先所有者に配布されていることを確認します。ボリューム所有者を表示するには、[その他]>[所有権の変更]*を選択します。
.. すべてのボリュームが優先所有者に所有されている場合は、手順5に進みます。
.. いずれのボリュームも戻っていない場合は、手動でボリュームを戻す必要があります。詳細›ボリュームの再配置*に進みます。
.. 自動配信または手動配信のあとに一部のボリュームだけが優先所有者に戻される場合は、Recovery Guruでホスト接続の問題がないかを確認する必要があります。
.. Recovery Guruが表示されない場合、またはRecovery Guruの手順に従ってもボリュームが優先所有者に戻らない場合は、サポートにお問い合わせください。


. SANtricity システムマネージャを使用してストレージアレイのサポートデータを収集します。
+
.. *サポート›サポートセンター›診断*を選択します。
.. 「サポートデータの収集」を選択します。
.. [*Collect*]( 収集 ) をクリックします
+
ブラウザの Downloads フォルダに、「 * support-data.7z * 」という名前でファイルが保存されます。





--
====
.次の手順
これでバッテリの交換は完了です。通常の運用を再開することができます。
