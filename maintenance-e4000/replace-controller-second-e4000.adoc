---
permalink: maintenance-e4000/replace-controller-second-e4000.html 
sidebar: sidebar 
keywords:  
summary:  
---
= E4000に2つ目のキャニスターを追加する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
E4000 アレイには 2 台目のコントローラキャニスターを追加できます。

.このタスクについて
E4012コントローラシェルフのシンプレックスバージョンに2台目のコントローラキャニスターを追加します。この手順は、オンライン手順であるシンプレックスからデュプレックスへの変換とも呼ばれます。この手順の実行中もストレージアレイ上のデータにアクセスすることができます。

.作業を開始する前に
次のものがあることを確認します。

* 現在取り付けられているコントローラキャニスターと同じパーツ番号の新しいコントローラキャニスター。（部品番号を確認するには、手順 1 を参照してください）。
* ESD リストバンドを装着するか、静電気防止処置を施します。
* No.1 プラスドライバ。
* 新しいケーブルを識別するためのラベル。互換性のあるハードウェアについては、または http://hwu.netapp.com/home.aspx["NetApp Hardware Universe の略"]を参照して https://mysupport.netapp.com/NOW/products/interoperability["NetApp Interoperability Matrix を参照してください"]ください。
* 新しいコントローラポートの接続に必要なすべてのケーブル、トランシーバ、スイッチ、ホストバスアダプタ（ HBA ）。
* コントローラの SANtricity System Manager にアクセスできるブラウザを備えた管理ステーション。（System Managerインターフェイスを開くには、コントローラのドメイン名またはIPアドレスをブラウザで指定します）。




== 手順 1 ：新しいコントローラのパーツ番号を確認します

新しいコントローラのパーツ番号が現在取り付けられているコントローラと同じであることを確認します。

.手順
. 新しいコントローラキャニスターを開封し、静電気防止処置を施した平らな場所に置きます。梱包材は、障害が発生したコントローラキャニスターを発送するときのためにすべて保管しておいてください。
. コントローラキャニスターの背面にある MAC アドレスと FRU パーツ番号のラベルを確認します。
. SANtricity System Manager で、取り付けられているコントローラキャニスターの交換パーツ番号を確認します。
+
.. 「 * ハードウェア * 」を選択します。
.. コントローラアイコンが表示されたコントローラシェルフを探します。
.. コントローラのアイコンをクリックしimage:../media/sam1130_ss_hardware_controller_icon_maint-e2800.gif["コントローラアイコンのGIF"]ます。
.. コントローラを選択し、 * 次へ * をクリックします。
.. [*Base] タブで、コントローラの交換パーツ番号 * をメモします。


. 取り付けられているコントローラの交換パーツ番号が新しいコントローラの FRU パーツ番号と同じであることを確認します。
+

CAUTION: *データアクセスが失われる可能性*—2つの部品番号が同じでない場合は、この手順を実行しないでください。コントローラが一致していないと、新しいコントローラをオンラインにしたときにロックダウン状態になります。

. SANtricity System Managerを使用してストレージアレイの構成データベースをバックアップします。
+
コントローラを取り外すときに問題が発生した場合は、保存したファイルを使用して構成をリストアできます。RAID 構成データベースの現在の状態が保存されます。これには、コントローラ上のボリュームグループとディスクプールのすべてのデータが含まれます。System Managerから次の手順を実行します。

+
.. *サポート›サポートセンター›診断*を選択します。
.. [ 構成データの収集 *] を選択します。
.. [*Collect*]( 収集 ) をクリックします
+
ファイルは、ブラウザの* Downloads *フォルダに* configurationdata -<arrayName>-<dateTime>.7z*という名前で保存されます。







== 手順 2 ：ホストインターフェイスカードを取り付ける

現在取り付けられているコントローラにホストインターフェイスカード（HIC）が搭載されている場合は、同じモデルのHICを2台目のコントローラキャニスターに取り付ける必要があります。

.手順
. 新しいHICを開封し、既存のHICと同じであることを確認します。
+

CAUTION: *データアクセスが失われる可能性*：2つのコントローラキャニスターに同じHICを取り付ける必要があります。交換用 HIC と交換する HIC が同じでない場合は、この手順を使用しないでください。HIC 原因が一致していないと、新しいコントローラをオンラインにしたときにロックダウン状態になります。

. HICカードベゼルをコントローラモジュールからまっすぐ引き出して取り外します。
. HICカードを取り出し、マザーボードのソケットに合わせます。
. カードをそっと押し下げてソケットに装着します。
. 3本の蝶ネジを締めます。
+

CAUTION: ネジを締めすぎないように注意してください。HICカードが破損するおそれがあります。

. HICカードベゼルを再度取り付けます。




== 手順 3 ：サポートデータを収集する

コンポーネントを交換する前後にサポートデータを収集しておけば、交換しても問題が解決しない場合に、テクニカルサポートにすべてのログを送信できます。

.手順
. SANtricity System Manager のホームページで、ストレージアレイのステータスが最適であることを確認します。
+
ステータスが「最適」でない場合は、 Recovery Guru を使用するかテクニカルサポートに問い合わせて問題を解決してください。この手順を続行しないでください。

. SANtricity システムマネージャを使用してストレージアレイのサポートデータを収集します。
+
.. *サポート›サポートセンター›診断*を選択します。
.. 「サポートデータの収集」を選択します。
.. [*Collect*]( 収集 ) をクリックします
+
ブラウザの Downloads フォルダに、「 * support-data.7z * 」という名前でファイルが保存されます。



. ストレージアレイと接続されているすべてのホストの間で I/O 処理が発生しないようにします。たとえば、次の手順を実行します。
+
** ストレージからホストにマッピングされた LUN に関連するすべてのプロセスを停止します。
** ストレージからホストにマッピングされた LUN にアプリケーションがデータを書き込んでいないことを確認します。
** アレイのボリュームに関連付けられているファイルシステムをすべてアンマウントします。
+

NOTE: ホスト I/O 処理を停止する具体的な手順はホストオペレーティングシステムや構成によって異なり、ここでは説明していません。環境内でホスト I/O 処理を停止する方法がわからない場合は、ホストをシャットダウンすることを検討してください。

+

CAUTION: *データ損失の可能性*—I/O処理の実行中にこの手順を続行すると、データが失われる可能性があります。







== 手順 4 ：設定をデュプレックスに変更する

コントローラシェルフに 2 台目のコントローラを追加する前に、構成をデュプレックスに変更する必要があります。これを行うには、新しい NVSRAM ファイルをインストールし、コマンドラインインターフェイスを使用してストレージアレイをデュプレックスに設定します。デュプレックスバージョンの NVSRAM ファイルは、 SANtricity OS ソフトウェア（コントローラファームウェア）のダウンロードファイルに付属しています。

.手順
. 最新の NVSRAM ファイルをネットアップサポートサイトから管理クライアントにダウンロードします。
+
.. SANtricityシステムマネージャで、*サポート›アップグレードセンター*を選択します。「 SANtricity OS Software upgrade 」というラベルの付いた領域で、「 NetApp SANtricity OS Downloads * 」をクリックします。
.. ネットアップサポートサイトで、「 * E-Series SANtricity OS Controller software * 」を選択します。
.. オンラインの手順に従ってインストールする NVSRAM のバージョンを選択し、ファイルのダウンロードを完了します。デュプレックスバージョンのNVSRAMを選択してください（ファイル名の末尾に「D」が付いています）。
+
ファイル名は次のようになります。 * N290X-830834-D01.dlp *



. SANtricity System Manager を使用してファイルをアップグレードします。
+

CAUTION: *データ損失またはストレージアレイの破損のリスク*—アップグレードの実行中はストレージアレイに変更を加えないでください。ストレージアレイへの電源を維持します。

+
アップグレード前の健常性チェックの間は処理をキャンセルできますが、転送またはアクティブ化の実行中はキャンセルできません。

+
** SANtricity システムマネージャで次の作業を行います。
+
... SANtricity OS ソフトウェアのアップグレード * で、 * アップグレードの開始 * をクリックします。
... Select Controller NVSRAM file * の横の * Browse * をクリックし、ダウンロードした NVSRAM ファイルを選択します。
... [ * スタート * ] をクリックし、操作を確定します。
+
アップグレードが開始され、次の処理が実行されます。

+
**** アップグレード前の健常性チェックが開始されます。アップグレード前の健常性チェックに失敗した場合は、 Recovery Guru を使用するか、テクニカルサポートに問い合わせて問題を解決してください。
**** コントローラファイルが転送されてアクティブ化されます。所要時間はストレージアレイの構成によって異なります。
**** コントローラが自動的にリブートし、新しい設定が適用されます。




** または、次の CLI コマンドを使用してアップグレードを実行することもできます。
+
[listing]
----
download storageArray NVSRAM file="filename" healthCheckMelOverride=FALSE;
----
+
このコマンドの `filename`は、デュプレックスバージョンのコントローラNVSRAMファイル（名前に「D」が付いたファイル）のファイルパスとファイル名です。ファイルパスとファイル名は二重引用符（""）で囲みます。例：

+
[listing]
----
file="C:\downloads\N290X-830834-D01.dlp"
----


. （オプション）アップグレードされた内容のリストを表示するには、 * ログの保存 * をクリックします。
+
ブラウザの Downloads フォルダに、「 * latest-upgrade-log-timestamp.txt * 」という名前でファイルが保存されます。

+
** コントローラ NVSRAM をアップグレードしたら、 SANtricity System Manager で次の点を確認します。
+
*** ハードウェアページに移動し、すべてのコンポーネントが表示されることを確認します。
*** [ソフトウェアとファームウェアのインベントリ]ダイアログボックスに移動します（*[サポート]›[アップグレードセンター]*に移動し、*[ソフトウェアとファームウェアのインベントリ]*のリンクをクリックします）。新しいソフトウェアとファームウェアのバージョンを確認します。


** コントローラ NVSRAM をアップグレードする場合、既存の NVSRAM に適用されていたカスタム設定はアクティブ化のプロセスで失われます。カスタム設定は、アクティブ化のプロセスの完了後に NVSRAM に再度適用する必要があります。


. CLI コマンドを使用してストレージアレイの設定をデュプレックスに変更します。CLIを使用するには、CLIパッケージをダウンロードした場合にコマンドプロンプトを開きます。
+
** コマンドプロンプトから、次の手順を実行します
+
... 次のコマンドを使用して、アレイをシンプレックスからデュプレックスに切り替えます。
+
[listing]
----
set storageArray redundancyMode=duplex;
----
... コントローラをリセットするには、次のコマンドを使用します。
+
[listing]
----
reset controller [a];
----






コントローラのリブート後、「alternate controller missing」というエラーメッセージが表示されます。コントローラ A がデュプレックスモードに変換されました。このメッセージは、 2 台目のコントローラを取り付けてホストのケーブルを接続するまで表示されます。



== 手順 5 ：ブランクカバーを取り外します

2 台目のコントローラを取り付ける前に、ブランクカバーを取り外します。ブランクカバーは、コントローラが 1 台だけのコントローラシェルフに取り付けられています。

.手順
. ブランクカバーのカムハンドルのラッチを外れるまで押し、カムハンドルを右側に開きます。
. ブランクカバーをスライドしてシェルフから引き出し、脇に置きます。
+
ブランクカバーを取り外すと、可動式のふたが所定の位置に戻って空いているベイがふさがれます。





== 手順6：2台目のコントローラキャニスターを取り付ける

2 台目のコントローラキャニスターを取り付けてシンプレックス構成からデュプレックス構成に変更します。

. まだ接地していない場合は、自分で適切に接地してください。
. 取り外し可能なカバーが下になるようにコントローラキャニスターを裏返します。
. コントローラモジュールの端をシャーシの開口部に合わせ、コントローラモジュールをシステムの半分までそっと押し込みます。
. カムハンドルを開いた状態で、コントローラモジュールをミッドプレーンまでしっかりと押し込んで完全に装着し、カムハンドルをロック位置まで閉じます。
+

NOTE: コネクタの破損を防ぐため、コントローラモジュールをスライドさせてシャーシに挿入する際に力を入れすぎないでください。コントローラは、シャーシに装着されるとすぐにブートを開始します。

. ケーブルマネジメントデバイスを再度取り付けます（まだ取り付けていない場合）。
. フックとループストラップを使用して、ケーブルをケーブルマネジメントデバイスにバインドします。




== 手順 7 ： 2 台目のコントローラの追加を完了します

2 台目のコントローラが正しく動作していることを確認し、デュプレックスの NVSRAM ファイルを再インストールし、コントローラにボリュームを分散し、サポートデータを収集します。

.手順
. コントローラをオンラインにします。
+
.. System Managerで、*[ハードウェア]*ページに移動します。
.. 「 * コントローラの背面を表示 * 」を選択します。
.. 交換したコントローラを選択します。
.. ドロップダウンリストから「オンラインにする」 * を選択します。


. コントローラのブート時に、コントローラの LED を確認します。
+
もう一方のコントローラとの通信が再確立されると次のような状態

+
** 黄色の警告 LED が点灯した状態になります。
** ホストリンク LED は、ホストインターフェイスに応じて、点灯、点滅、消灯のいずれかになります。


. 次のCLIコマンドを使用して、アレイの設定をシンプレックスからデュプレックスに更新します。
+
'et storageArray redundancyMode=duplex;

. コントローラがオンラインに戻ったら、ステータスが「最適」になっていることを確認し、コントローラシェルフの警告 LED を確認します。
+
ステータスが「最適」でない場合やいずれかの警告 LED が点灯している場合は、すべてのケーブルが正しく装着され、コントローラキャニスターが正しく取り付けられていることを確認します。必要に応じて、コントローラキャニスターを取り外して再度取り付けます。

+

NOTE: 問題が解決しない場合は、テクニカルサポートにお問い合わせください。

. SANtricity System Manager を使用して、デュプレックスバージョンの NVSRAM ファイルを再インストールします。
+
この手順により、両方のコントローラでこのファイルのバージョンが同じになります。

+

CAUTION: データ損失またはストレージアレイの破損のリスク-アップグレードの実行中はストレージアレイに変更を加えないでください。ストレージアレイへの電源を維持します。

+

NOTE: SANtricity System Manager を使用して新しい NVSRAM ファイルをインストールする場合は、 SANtricity OS ソフトウェアをインストールする必要があります。最新バージョンの SANtricity OS ソフトウェアがすでにインストールされている場合は、そのバージョンを再インストールする必要があります。

+
.. [ハードウェア]>[サポート]>[アップグレードセンター]*をクリックして、最新バージョンのSANtricity OSがインストールされていることを確認します。必要に応じて、最新バージョンをインストールします。
.. System Managerで、*[アップグレードセンター]*に移動します。
.. SANtricity OS ソフトウェアのアップグレード * で、 * アップグレードの開始 * をクリックします。
.. [*Browse*]( 参照 ) をクリックし、 SANtricity OS ソフトウェアファイルを選択します。
.. * 参照 * をクリックし、コントローラ NVSRAM ファイルを選択します。
.. [ * スタート * ] をクリックし、操作を確定します。
+
制御の転送が開始されます。



. コントローラのリブート後、必要に応じてコントローラ A と新しいコントローラ B にボリュームを分散します
+
.. [ストレージ]>[ボリューム]*を選択します。
.. [すべてのボリューム]タブで、*[その他]›[所有権の変更]*を選択します。
.. テキストボックスに「所有権の変更」というコマンドを入力します
+
所有権の変更ボタンが有効になります。

.. 再配布するボリュームごとに、 [* Preferred Owner* （優先所有者 * ） ] リストから [* Controller B* （コントローラ B * ） ] を選択します。
.. [ 所有権の変更 ] をクリックします。
+
プロセスが完了すると、 [ ボリューム所有権の変更 ] ダイアログに、 * 優先所有者 * と * 現在の所有者 * の新しい値が表示されます。



. SANtricity システムマネージャを使用してストレージアレイのサポートデータを収集します。
+
.. *サポート›サポートセンター›診断*を選択します。
.. [*Collect*]( 収集 ) をクリックします
+
ブラウザの Downloads フォルダに、「 * support-data.7z * 」という名前でファイルが保存されます。





.次の手順
これで2台目のコントローラを追加するプロセスは完了です。通常の運用を再開することができます。
