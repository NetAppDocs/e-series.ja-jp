---
permalink: config-vmware/iscsi-perform-specific-task.html 
sidebar: sidebar 
keywords: iscsi, express vmware configuration, software configuration, vmware host, E2800, E5700, EF300, EF600, E-Series, eseries 
summary: iSCSI プロトコルを使用する場合は、スイッチを設定し、アレイ側とホスト側でネットワークを設定します。その後、 IP ネットワーク接続を確認します。 
---
= iSCSI 固有のタスクを実行
:allow-uri-read: 
:experimental: 
:icons: font
:imagesdir: ../media/


[role="lead"]
iSCSI プロトコルを使用する場合は、スイッチを設定し、アレイ側とホスト側でネットワークを設定します。その後、 IP ネットワーク接続を確認します。



== 手順1：スイッチを設定します（iSCSI、VMware）

iSCSI に関するベンダーの推奨事項に従ってスイッチを設定します。これらの推奨事項には、設定の指示とコードの更新が含まれる場合があります。

.必要なもの
* 高可用性を実現するために、 2 つの独立したネットワークiSCSI トラフィックを別々のネットワークセグメントに分離してください。
* 送受信ハードウェアフロー制御 * エンドツーエンド * を有効にしました。
* 優先度フロー制御が無効になりました。
* 必要に応じて、ジャンボフレームを有効にします。



NOTE: コントローラのスイッチポートでは、ポートチャネル / LACP がサポートされません。ホスト側 LACP は推奨されません。マルチパスを使用すると、同等以上のメリットが得られます。

.手順
スイッチベンダーのマニュアルを参照してください。



== 手順2：ネットワークを設定する-- iSCSI VMware

iSCSI ネットワークは、データストレージの要件に応じて、さまざまな方法でセットアップできます。環境に最適な構成を選択するには、ネットワーク管理者に相談してください。

.必要なもの
* 送受信ハードウェアフロー制御 * エンドツーエンド * を有効にしました。
* 優先度フロー制御が無効になりました。
* 必要に応じて、ジャンボフレームを有効にします。
+
パフォーマンス上の理由から IP SAN 内でジャンボフレームを使用している場合は、アレイ、スイッチ、およびホストでジャンボフレームを使用するように設定してください。ホストおよびスイッチでジャンボフレームを有効にする方法については、使用するオペレーティングシステムとスイッチのドキュメントを参照してください。アレイでジャンボフレームを有効にするには、手順 3 の手順を実行します。



.このタスクについて
iSCSI ネットワークを計画する際は、に留意してください https://configmax.vmware.com/home["VMware 構成の最大数"^] ガイドには、サポートされる iSCSI ストレージパスの最大数は 8 と記載されています。この要件を考慮して、設定するパス数を多くしないようにしてください。

iSCSI ポートバインドを使用していない場合、 VMware iSCSI ソフトウェアイニシエータによって iSCSI ターゲットごとに 1 つのセッションがデフォルトで作成されます。


NOTE: VMware iSCSI ポートバインドは、バインドされているすべての VMkernel ポートを、設定されたネットワークセグメント上でアクセス可能なすべてのターゲットポートに強制的にログインさせる機能です。これは、 iSCSI ターゲットに単一のネットワークアドレスを提供するアレイで使用するためのものです。iSCSI ポートバインドは使用しないことを推奨します。追加情報の場合は、を参照してください http://kb.vmware.com/["VMware のナレッジベース"] を参照してください。この記事では、 ESX / ESXi でソフトウェア iSCSI ポートバインドを使用する場合の考慮事項について説明しています。ESXi ホストを別のベンダーのストレージに接続している場合は、ポートバインドとの競合を避けるために、別の iSCSI VMkernel ポートを使用することを推奨します。

ベストプラクティスとして、 E シリーズストレージアレイではポートバインドを使用しないでください。

適切なマルチパス構成を実現するために、 iSCSI ネットワークに複数のネットワークセグメントを使用します。ホスト側のポートと各アレイコントローラのポートを少なくとも 1 つずつ 1 つのネットワークセグメントに配置し、同じグループのホスト側とアレイ側のポートをもう 1 つのネットワークセグメントに配置します。可能であれば、複数のイーサネットスイッチを使用してさらに冗長性を確保します。

.手順
スイッチベンダーのマニュアルを参照してください。


NOTE: 多くのネットワークスイッチは 9 、 000 バイトを超える IP オーバーヘッドを設定する必要があります。詳細については、スイッチのマニュアルを参照してください。



== 手順3：アレイ側のネットワークを設定する- iSCSI、VMware

SANtricity System Manager の GUI を使用して、アレイ側の iSCSI ネットワークを設定します。

.必要なもの
* いずれかのストレージアレイコントローラの IP アドレスまたはドメイン名。
* System Manager GUI 、ロールベースアクセス制御（ RBAC ）、または LDAP のパスワード、およびディレクトリサービスを設定して、ストレージアレイへの適切なセキュリティアクセスを可能にします。アクセス管理の詳細については、 SANtricity システムマネージャオンラインヘルプを参照してください。


.このタスクについて
このタスクでは、ハードウェアページから iSCSI ポート設定にアクセスする方法について説明します。設定には、 System （設定） > Configure iSCSI Ports （ iSCSI ポートの設定）メニューからもアクセスできます。


NOTE: VMware 構成でアレイ側のネットワークをセットアップする方法については、次のテクニカルレポートを参照してください。追加情報 https://www.netapp.com/us/media/tr-4789.pdf["『 VMware Configuration Guide for E Series SANtricity iSCSI Integration with ESXi 6.x and 7.x 』"]。

.手順
. ブラウザで、「 + https://<DomainNameOrIPAddress>+` 」という URL を入力します
+
「 IPAddress 」は、ストレージアレイコントローラの 1 つのアドレスです。

+
設定されていないアレイで初めて SANtricity システムマネージャを開くと、管理者パスワードの設定プロンプトが表示されます。ロールベースアクセス管理では、 admin 、 support 、 security 、 monitor の 4 つのローカルロールが設定されます。最後の 3 つのロールには、推測されにくいランダムなパスワードが設定されています。admin ロールのパスワードを設定したら、 admin クレデンシャルを使用してすべてのパスワードを変更できます。4 つのローカルユーザロールの詳細については、 SANtricity System Manager オンラインヘルプを参照してください。

. 管理者パスワードの設定フィールドとパスワードの確認フィールドに管理者ロールの System Manager パスワードを入力し、 * パスワードの設定 * をクリックします。
+
プール、ボリュームグループ、ワークロード、または通知が設定されていない場合は、セットアップウィザードが起動します。

. セットアップウィザードを閉じます。
+
このウィザードは、あとで追加のセットアップタスクを実行する際に使用します。

. 「 * ハードウェア * 」を選択します。
. 図にドライブが表示されている場合は、 * シェルフの背面を表示 * をクリックします。
+
図の表示が切り替わり、ドライブではなくコントローラが表示されます。

. iSCSI ポートを設定するコントローラをクリックします。
+
コントローラのコンテキストメニューが表示されます。

. Configure iSCSI Port* （ iSCSI ポートの設定）を選択します。
+
Configure iSCSI Ports （ iSCSI ポートの設定）ダイアログボックスが開きます。

. ドロップダウンリストで、設定するポートを選択し、 * Next * をクリックします。
. 構成ポートの設定を選択し、 * 次へ * をクリックします。
+
すべてのポート設定を表示するには、ダイアログボックスの右側にある * Show more port settings * リンクをクリックします。

+
|===
| ポートの設定 | 説明 


 a| 
イーサネットポート速度の設定
 a| 
目的の速度を選択します。ドロップダウンリストに表示されるオプションは、ネットワークがサポートできる最大速度（ 10Gbps など）によって異なります。


NOTE: コントローラで使用可能なオプションの 25Gb iSCSI ホストインターフェイスカードは速度を自動ネゴシエートしません。各ポートの速度を 10Gb または 25Gb に設定する必要があります。すべてのポートを同じ速度に設定する必要があります。



 a| 
IPv4 を有効にする / IPv6 を有効にする
 a| 
一方または両方のオプションを選択して、 IPv4 ネットワークと IPv6 ネットワークのサポートを有効にします。



 a| 
TCP リスニングポート（ [Show more port settings] をクリックすると使用可能）
 a| 
必要に応じて、新しいポート番号を入力します。

リスニングポートは、コントローラがホスト iSCSI イニシエータからの iSCSI ログインをリスンするために使用する TCP ポート番号です。デフォルトのリスニングポートは 3260 です。3260 、または 49152~65535 の値を入力する必要があります。



 a| 
MTU サイズ（ * Show more port settings* をクリックすると使用可能）
 a| 
必要に応じて、 Maximum Transmission Unit （ MTU ；最大伝送ユニット）の新しいサイズをバイト単位で入力します。

デフォルトの Maximum Transmission Unit （ MTU ；最大転送単位）サイズは 1500 バイト / フレームです。1500~9000 の値を入力する必要があります。



 a| 
ICMP PING 応答を有効にします
 a| 
Internet Control Message Protocol （ ICMP ）を有効にする場合は、このオプションを選択します。ネットワーク接続されたコンピュータのオペレーティングシステムは、このプロトコルを使用してメッセージを送信します。ICMP メッセージを送信することで、ホストに到達できるかどうかや、そのホストとのパケットの送受信にどれくらいの時間がかかるかが確認されます。

|===
+
[*IPv4 を有効にする *] を選択した場合は、 [ 次へ *] をクリックすると、 IPv4 設定を選択するためのダイアログボックスが開きます。[*IPv6 を有効にする *] を選択した場合、 [ 次へ *] をクリックすると、 IPv6 設定を選択するためのダイアログボックスが開きます。両方のオプションを選択した場合は、 IPv4 設定のダイアログボックスが最初に開き、 * 次へ * をクリックすると、 IPv6 設定のダイアログボックスが開きます。

. IPv4 と IPv6 、またはその両方を自動または手動で設定します。すべてのポート設定を表示するには、ダイアログボックスの右側にある * Show more settings * リンクをクリックします。
+
|===
| ポートの設定 | 説明 


 a| 
自動的に設定を取得します
 a| 
設定を自動的に取得するには、このオプションを選択します。



 a| 
静的な設定を手動で指定します
 a| 
このオプションを選択した場合は、フィールドに静的アドレスを入力します。IPv4 の場合は、ネットワークのサブネットマスクとゲートウェイも指定します。IPv6 の場合は、ルーティング可能な IP アドレスとルータの IP アドレスも指定します。

|===
. [ 完了 ] をクリックします。
. System Manager を終了します。




== 手順4：ホスト側のネットワークを設定する- iSCSI

ホスト側で iSCSI ネットワークを設定すると、 VMware iSCSI イニシエータがアレイとのセッションを確立できるようになります。

.このタスクについて
ホスト側で iSCSI ネットワークを設定するこのクイック方式では、 ESXi ホストから 4 つの冗長パスを経由してストレージに iSCSI トラフィックを伝送できるようにします。

このタスクが完了すると、ホストには、両方の VMkernel ポートと両方の VMNIC で構成される単一の vSwitch が設定されます。

VMware の iSCSI ネットワークを設定する追加情報については、を参照してください https://docs.vmware.com/en/VMware-vSphere/index.html["VMware vSphere のドキュメント"^] 使用する vSphere のバージョンに対応しています。

.手順
. iSCSI ストレージトラフィックの伝送に使用するスイッチを設定します。
. 送受信ハードウェアフロー制御 * エンドツーエンド * を有効にします。
. 優先度フロー制御を無効にします。
. アレイ側の iSCSI 設定を完了します。
. iSCSI トラフィックに 2 つの NIC ポートを使用します。
. vSphere Client または vSphere Web Client を使用して、ホスト側の設定を行います。
+
インターフェイスの機能はそれぞれ異なり、ワークフローも完全に同じにはなりません。





== 手順5：IPネットワーク接続の確認-- iSCSI、VMware

インターネットプロトコル（ IP ）ネットワーク接続を確認するには、 ping テストを使用してホストとアレイが通信できることを確認します。

.手順
. ジャンボフレームが有効かどうかに応じて、ホストから次のいずれかのコマンドを実行します。
+
** ジャンボフレームが有効になっていない場合は、次のコマンドを実行します。
+
[listing]
----
vmkping <iSCSI_target_IP_address\>
----
** ジャンボフレームが有効な場合は、ペイロードサイズに 8 、 972 バイトを指定して ping コマンドを実行します。IP と ICMP を組み合わせたヘッダーは 28 バイトで、これがペイロードに追加されて 9 、 000 バイトになります。-s スイッチは 'packet size ビットを設定しますd オプションは、 IPv4 パケットに DF （ Don't Fragment ）ビットを設定します。これらのオプションにより、 iSCSI イニシエータとターゲットの間で 9 、 000 バイトのジャンボフレームを正常に送信できます。
+
[listing]
----
vmkping -s 8972 -d <iSCSI_target_IP_address\>
----
+
この例では、 iSCSI ターゲットの IP アドレスは「 192.0.2.8 」です。

+
[listing]
----
vmkping -s 8972 -d 192.0.2.8
Pinging 192.0.2.8 with 8972 bytes of data:
Reply from 192.0.2.8: bytes=8972 time=2ms TTL=64
Reply from 192.0.2.8: bytes=8972 time=2ms TTL=64
Reply from 192.0.2.8: bytes=8972 time=2ms TTL=64
Reply from 192.0.2.8: bytes=8972 time=2ms TTL=64
Ping statistics for 192.0.2.8:
  Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
  Minimum = 2ms, Maximum = 2ms, Average = 2ms
----


. 問題 a vmkping コマンド：各ホストのイニシエータ・アドレス（ iSCSI に使用されるホスト・イーサネット・ポートの IP アドレス）から各コントローラの iSCSI ポートに送信されます構成内の各ホストサーバから、必要に応じて IP アドレスを変更してこの操作を実行します。
+

NOTE: コマンドが失敗し、「 endto （） failed （ Message too long ）」というメッセージが表示された場合は、ホストサーバ、ストレージコントローラ、およびスイッチポートのイーサネットインターフェイスの MTU サイズ（ジャンボフレームのサポート）を確認します。

. iSCSI Configuration 手順に戻り、ターゲットの検出を終了します。




== 手順 6 ：設定を記録します

このページの PDF を生成して印刷し、次のワークシートを使用してプロトコル固有のストレージ構成情報を記録できます。この情報は、プロビジョニングタスクを実行する際に必要になります。



=== 推奨される構成

推奨構成は、 2 つのイニシエータポートと 4 つのターゲットポートを 1 つ以上の VLAN で接続した構成です。

image::../media/50001_01_conf-vmw.gif[50001 01 conf vmw]



=== ターゲット IQN

|===
| 番号 | ターゲットポート接続 | IQN 


 a| 
2.
 a| 
ターゲットポート
 a| 

|===


=== マッピングホスト名

|===
| 番号 | ホスト情報 | 名前とタイプ 


 a| 
1.
 a| 
マッピングホスト名
 a| 



 a| 
 a| 
ホスト OS タイプ
 a| 

|===